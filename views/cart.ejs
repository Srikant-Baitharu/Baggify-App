<%- include('./partials/header') %>

<div class="w-full px-20 py-10">
    <h2 class="text-3xl font-semibold mb-8">Your Cart</h2>

    <% if (!user.cart || user.cart.length === 0) { %>
        <div class="text-center text-xl text-gray-600 mt-10">
            Your cart is empty ðŸ˜•
        </div>
    <% } else { %>

    <div class="grid grid-cols-1 gap-6">
        <% user.cart.forEach(function(item) {
            if (!item) return;
            let quantity = item.quantity || 1;
            let price = Number(item.price || 0);
            let itemTotal = (price * quantity) + 20 - Number(item.discount || 0);
        %>
        <div class="flex border rounded-lg overflow-hidden shadow">
            <div class="w-[20%] bg-[<%= item.bgcolor || '#f5f5f5' %>] flex justify-center items-center">
                <img class="h-40" src="data:image/jpeg;base64,<%= item.image?.toString('base64') %>" alt="">
            </div>
            <div class="w-[80%] p-5 bg-[<%= item.panelcolor || '#fff' %>]">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">Clinge Bag</h3>
                    <form action="/remove-from-cart/<%= item._id %>" method="POST">
                        <button class="text-red-600 hover:underline" type="submit">Remove</button>
                    </form>
                </div>

                <div class="flex items-center gap-4 my-2">
                    <form action="/update-quantity/<%= item._id %>?action=decrease" method="POST">
                        <button class="px-3 py-1 rounded bg-gray-300 text-black" <%= quantity <= 1 ? "disabled" : "" %>>âˆ’</button>
                    </form>
                    <span class="text-lg font-semibold"><%= quantity %></span>
                    <form action="/update-quantity/<%= item._id %>?action=increase" method="POST">
                        <button class="px-3 py-1 rounded bg-gray-300 text-black">+</button>
                    </form>
                </div>

                <div class="flex justify-between mt-3">
                    <div>
                        <p>MRP: â‚¹ <%= price %></p>
                        <p>Platform Fee: â‚¹ 20</p>
                        <p>Shipping: FREE</p>
                        <p>Discount: â‚¹ <%= item.discount || 0 %></p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-semibold text-green-700">Net Total: â‚¹ <%= itemTotal %></p>
                    </div>
                </div>
            </div>
        </div>
        <% }); %>
    </div>

    <div class="w-full flex justify-between items-center mt-10">
        <div class="bg-gray-100 p-6 rounded-lg shadow w-1/3">
            <h3 class="text-xl mb-3">Total Amount</h3>
            <div class="flex justify-between text-lg">
                <span>Total:</span>
                <span class="text-green-700 font-semibold">â‚¹ <%= bill %></span>
            </div>
        </div>

        <form action="/checkout" method="POST">
            <button class="bg-green-600 text-white px-6 py-3 rounded shadow hover:bg-green-700">
                Proceed to Checkout
            </button>
        </form>
    </div>

    <% } %>
</div>

<%- include('./partials/footer') %>
